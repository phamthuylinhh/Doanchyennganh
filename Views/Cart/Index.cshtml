 @using Doan.Models;
 @using Doan.Utilities;
@{
    Layout = "/Views/Shared/_Layout1.cshtml";
}
@{
    decimal totalAmount = 0;
}
    <section class="ftco-section ftco-cart" style="margin-top: 120px ; color:red">
        <div class="container">
            <div class="row" >
                <div class="col-md-12 ftco-animate">
                    <div class="cart-list">
                        <table class="table" style="background-color:red">
                            <thead class="thead-primary">
                                <tr class="text-center" style="red">
                                    <th>&nbsp;</th>
                                    <th>&nbsp;</th>
                                    <th style="background-color:aquamarine">Tên sản phẩm</th>
                                    <th>Giá tiền</th>
                                    <th>Số lượng</th>
                                    <th>Tổng tiền</th>
                                </tr>
                            </thead>
                            <tbody>3
                            @foreach (var item in @Model)
                            {
                                <tr class="text-center" data-product-id="@item.Cart.Product_id" data-size-id="@item.Cart.Size_id" data-user-id="@item.Cart.User_id">
                                    <td class="product-remove">
                                        <a class="ion-ios-close" style="border-radius: 8px; width:40px;" href="/cart/del/@item.Cart.Product_id/@item.Cart.Size_id"></a>
                                    </td>
                                    <td class="image-prod"><div class="img" style="background-image:url(@item.Products.Images);"></div></td>
                                    <td class="product-name">
                                        <h3 style="font-family:'Times New Roman'">@item.Products.Name</h3>
                                        <p>@item.Product_size.Name</p>
                                    </td>
                                    <td class="price">@item.Products.Price VND</td>
                                    <td class="quantity">
                                        <input type="number" name="quantity" class="quantity form-control input-number" value="@item.Cart.Quantity" min="1" max="20">
                                        <p style="font-family:'Times New Roman'; font-size:small">Số lượng tối đa là 20 sản phẩm</p>
                                    </td>
                                    <td class="total">@(item.Cart.Quantity * item.Products.Price) VND</td>
                                </tr>
                                decimal totalPrice = item.Products.Price * item.Cart.Quantity;
                                totalAmount += totalPrice;
                            }
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row justify-content-end">
                <div class="col-lg-4 mt-5 cart-wrap ftco-animate">
                    <div class="cart-total mb-3">
                        <h3>Coupon Code</h3>
                        <p>Enter your coupon code if you have one</p>
                        <form action="#" class="info">
                            <div class="form-group">
                                <label for="">Coupon code</label>
                                <input type="text" class="form-control text-left px-3" placeholder="">
                            </div>
                        </form>
                    </div>
                    <p><a href="checkout.html" class="btn btn-primary py-3 px-4">Apply Coupon</a></p>
                </div>
                <div class="col-lg-4 mt-5 cart-wrap ftco-animate">
                    <div class="cart-total mb-3">
                        <h3>Estimate shipping and tax</h3>
                        <p>Enter your destination to get a shipping estimate</p>
                        <form action="#" class="info">
                            <div class="form-group">
                                <label for="">Country</label>
                                <input type="text" class="form-control text-left px-3" placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="country">State/Province</label>
                                <input type="text" class="form-control text-left px-3" placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="country">Zip/Postal Code</label>
                                <input type="text" class="form-control text-left px-3" placeholder="">
                            </div>
                        </form>
                    </div>
                    <p><a href="checkout.html" class="btn btn-primary py-3 px-4">Estimate</a></p>
                </div>
                <div class="col-lg-4 mt-5 cart-wrap ftco-animate">
                    <div class="cart-total mb-3">
                        <h3>Cart Totals</h3>
                        <p class="d-flex">
                            <span>Subtotal</span>
                            <span>@totalAmount VND</span>
                        </p>
                        <p class="d-flex">
                            <span>Delivery</span>
                            <span>$0.00</span>
                        </p>
                        <p class="d-flex">
                            <span>Discount</span>
                            <span>$0.00</span>
                        </p>
                        <hr>
                        <p class="d-flex total-price">
                            <span>Total</span>
                            <span>@totalAmount</span>
                        </p>
                    </div>
              
                      <p>
                    <a href="@Url.Action("Index", "Checkout")" class="btn btn-primary py-3 px-4">THANH TOÁN</a>
                </p> 

                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section ftco-no-pt ftco-no-pb py-5 bg-light">
        <div class="container py-4">
            <div class="row d-flex justify-content-center py-5">
                <div class="col-md-6">
                    <h2 style="font-size: 22px;" class="mb-0">Subcribe to our Newsletter</h2>
                    <span>Get e-mail updates about our latest shops and special offers</span>
                </div>
                <div class="col-md-6 d-flex align-items-center">
                    <form action="#" class="subscribe-form">
                        <div class="form-group d-flex">
                            <input type="text" class="form-control" placeholder="Enter email address">
                            <input type="submit" value="Subscribe" class="submit px-3">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>



    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" /><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00" /></svg></div>


    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="js/google-map.js"></script>
    <script src="js/main.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $(".quantity input").on('input', function () {
            var quantity = $(this).val();
            var price = $(this).closest('tr').find('.price').text().replace('$', '');
            var totalPrice = parseFloat(price) * parseInt(quantity);
            $(this).closest('tr').find('.total').text('$' + totalPrice.toFixed(2));
            // Recalculate totalAmount
            var totalAmount = 0;
            $('.total').each(function () {
                totalAmount += parseFloat($(this).text().replace('$', ''));
            });
            $('.total-price span:last').text('$' + totalAmount.toFixed(2));
        });
    });
    $(document).ready(function () {
        $(".quantity input").on('input', function () {
            var Quantity = $(this).val();
            $.ajax({
                url: '/Cart/UpdateQuantity',
                type: 'POST',
                data: {
                    Quantity: Quantity
                },
                success: function (response) {
                    var notificationContainer = $('#notification-container');
                    // Xóa thông báo cũ nếu có
                    notificationContainer.empty();
                    if (response.success) {
                        // Hiển thị thông báo thành công
                        var successNotification = $('<div>').addClass('notification success').text("Cập nhật số lượng thành công");
                        notificationContainer.append(successNotification);
                    } else {
                        // Hiển thị thông báo thất bại
                        var errorNotification = $('<div>').addClass('notification error').text("Cập nhật số lượng thất bại, vui lòng tải lại trang và thử lại");
                        notificationContainer.append(errorNotification);
                    }
                    // Ẩn thông báo sau 3 giây
                    setTimeout(function () {
                        notificationContainer.children().fadeOut(300, function () {
                            $(this).remove();
                        });
                    }, 3000);
                },
                error: function () {
                    // Xử lý khi có lỗi xảy ra
                    var errorNotification = $('<div>').addClass('notification error').text("Đã xảy ra lỗi khi cập nhật số lượng");
                    $('#notification-container').append(errorNotification);
                    // Ẩn thông báo sau 3 giây
                    setTimeout(function () {
                        errorNotification.fadeOut(300, function () {
                            $(this).remove();
                        });
                    }, 3000);
                }
            });
        });
    });
</script>
<script>
    window.addEventListener('load', function () {
        var alerts = document.querySelectorAll('.alert');
        alerts.forEach(function (alert) {
            setTimeout(function () {
                alert.classList.add('fade');
                setTimeout(function () {
                    alert.style.display = 'none';
                }, 300);
            }, 3000);
        });
    });
</script>









    <script>
        
        $(document).ready(function () {

            var quantitiy = 0;
            $('.quantity-right-plus').click(function (e) {

                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                var quantity = parseInt($('#quantity').val());

                // If is not undefined

                $('#quantity').val(quantity + 1);


                // Increment

            });

            $('.quantity-left-minus').click(function (e) {
                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                var quantity = parseInt($('#quantity').val());

                // If is not undefined

                // Increment
                if (quantity > 0) {
                    $('#quantity').val(quantity - 1);
                }
            });

        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	window.addEventListener('load', function () {
		var alerts = document.querySelectorAll('.alert');
		alerts.forEach(function (alert) {
			setTimeout(function () {
				alert.classList.add('fade');
				setTimeout(function () {
					alert.style.display = 'none';
				}, 300);
			}, 3000);
		});
	});
</script>



